{
   "$schema":"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
   "contentVersion":"1.0.0.0",
   "parameters":{
      "serverName":{
         "type":"string",
         "defaultValue":"[uniqueString('sql', resourceGroup().id)]",
         "metadata":{
            "description":"The name of the SQL logical server."
         }
      },
      "location":{
         "type":"string",
         "defaultValue":"[resourceGroup().location]",
         "metadata":{
            "description":"Location for all resources."
         }
      },
      "administratorLogin":{
         "type":"string",
         "metadata":{
            "description":"The administrator username of the SQL logical server."
         }
      },
      "administratorLoginPassword":{
         "type":"string",
         "metadata":{
            "description":"The administrator password of the SQL logical server."
         }
      }
   },
   "variables":{
	    "adminLogin":"[parameters('administratorLogin')]",
		"adminPassword":"[parameters('administratorLoginPassword')]",
        "al":"[parameters('administratorLoginPassword')]"      		
   },
   "resources":[
      {
         "type":"Microsoft.Sql/servers",
         "apiVersion":"2020-02-02-preview",
         "name":"[parameters('serverName')]",
         "location":"[parameters('location')]",
         "properties":{
            "administratorLogin":"[variables('adminLogin')]",
            "administratorLoginPassword":"[variables('adminPassword')]"
         },
         "resources":[
            {
               "type":"databases",
               "apiVersion":"2020-08-01-preview",
               "name":"['identityDb']",
               "location":"[parameters('location')]",
               "sku":{
                  "name":"Basic",
                  "tier":"Basic"
               },
               "dependsOn":[
                  "[resourceId('Microsoft.Sql/servers', concat(parameters('serverName')))]"
               ]
            },
			            {
               "type":"databases",
               "apiVersion":"2020-08-01-preview",
               "name":"['administration']",
               "location":"[parameters('location')]",
               "sku":{
                  "name":"Basic",
                  "tier":"Basic"
               },
               "dependsOn":[
                  "[resourceId('Microsoft.Sql/servers', concat(parameters('serverName')))]"
               ]
            },
			            {
               "type":"databases",
               "apiVersion":"2020-08-01-preview",
               "name":"['vendor']",
               "location":"[parameters('location')]",
               "sku":{
                  "name":"Basic",
                  "tier":"Basic"
               },
               "dependsOn":[
                  "[resourceId('Microsoft.Sql/servers', concat(parameters('serverName')))]"
               ]
            },
			            {
               "type":"databases",
               "apiVersion":"2020-08-01-preview",
               "name":"['customer']",
               "location":"[parameters('location')]",
               "sku":{
                  "name":"Basic",
                  "tier":"Basic"
               },
               "dependsOn":[
                  "[resourceId('Microsoft.Sql/servers', concat(parameters('serverName')))]"
               ]
            }
         ]
      }
   ],
   "outputs": {
		"DbcustomerConnectionString": {
		  "type": "string",
		  "value": "[concat('Server=tcp:', parameters('serverName') ,'.database.windows.net,1433;Initial Catalog=customer;Persist Security Info=False;User ID=',variables('adminLogin'),';Password=',parameters('administratorLoginPassword'),';MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;')]"
		},
	    "al": {
		  "type": "string",
		  "value": "[reference(parameters('serverName')).administratorLogin]"
		},
	    "ar": {
		  "type": "string",
		  "value": "[reference(parameters('serverName')).administratorLoginPassword]"
		}
	}
}